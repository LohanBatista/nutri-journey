generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  professionals Professional[]
  patients     Patient[]
}

model Professional {
  id                  String   @id @default(uuid())
  name                String
  email               String   @unique
  passwordHash        String
  role                String   @default("PROFESSIONAL") // "ADMIN" | "PROFESSIONAL"
  organizationId      String
  organization        Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  consultations       Consultation[]
  anthropometryRecords AnthropometryRecord[]
  labResults          LabResult[]
  nutritionPlans      NutritionPlan[]
  nutritionGeneralGuidances NutritionGeneralGuidance[]
}

model Patient {
  id             String   @id @default(uuid())
  fullName       String
  dateOfBirth    DateTime
  sex            String   // "MALE" | "FEMALE" | "OTHER"
  email          String?
  phone          String?
  tags           String[] @default([])
  notes          String?
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  consultations  Consultation[]
  anthropometryRecords AnthropometryRecord[]
  labResults     LabResult[]
  nutritionPlans NutritionPlan[]
  nutritionGeneralGuidances NutritionGeneralGuidance[]
}

model Consultation {
  id                String   @id @default(uuid())
  organizationId    String
  patientId         String
  patient           Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  professionalId    String
  professional      Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  dateTime          DateTime
  type              String   // "INITIAL" | "FOLLOW_UP" | "GROUP" | "HOSPITAL"
  mainComplaint     String?
  nutritionHistory  String?
  clinicalHistory   String?
  objectiveData     String?
  nutritionDiagnosis String?
  plan              String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model AnthropometryRecord {
  id                  String   @id @default(uuid())
  organizationId      String
  patientId           String
  patient             Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  professionalId      String
  professional        Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  date                DateTime
  weightKg            Float?
  heightM             Float?
  bmi                 Float?
  waistCircumference  Float?
  hipCircumference    Float?
  armCircumference    Float?
  notes               String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model LabResult {
  id              String   @id @default(uuid())
  organizationId  String
  patientId       String
  patient         Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  professionalId  String
  professional    Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  date            DateTime
  testType        String   // "GLYCEMIA" | "HBA1C" | "CT" | "HDL" | "LDL" | "TG" | "OTHER"
  name            String
  value           String   // Armazenado como string para suportar n√∫meros e strings
  unit            String
  referenceRange  String?
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model NutritionPlan {
  id            String   @id @default(uuid())
  organizationId String
  patientId     String
  patient       Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  professionalId String
  professional  Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  title         String
  goals         String
  notes         String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  meals         NutritionPlanMeal[]
}

model NutritionPlanMeal {
  id              String   @id @default(uuid())
  nutritionPlanId String
  nutritionPlan  NutritionPlan @relation(fields: [nutritionPlanId], references: [id], onDelete: Cascade)
  mealType        String   // "BREAKFAST" | "MORNING_SNACK" | "LUNCH" | "AFTERNOON_SNACK" | "DINNER" | "SUPPER" | "OTHER"
  description     String
  observation     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model NutritionGeneralGuidance {
  id                        String   @id @default(uuid())
  organizationId            String
  patientId                 String
  patient                   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  professionalId            String
  professional              Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  date                      DateTime
  hydrationGuidance         String?
  physicalActivityGuidance  String?
  sleepGuidance             String?
  symptomManagementGuidance String?
  notes                     String?
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
}

